# Custom hooks for state

-  `useEffect()` for life cycle events
-  Aim for declarative style
   -  Instead of directly updating the UI, set state that controls UI behavior

## Async loading

-  Currently, `SpeakersList` uses an array and we search through it
-  Real world, it will be a database and things will be differently
-  Simulate delayed load by adding a delay

-  Add `useEffect()` in `SpeakersList` to set state (`useState([] as ISpeaker[])` and `setSpeakers(data)` in the `useEffect()` instead)
-  Add a `delay()` function and call it in `useEffect()`
   -  `useEffect()` isn't async, so wrap the code in an async function and call that function

```TypeScript
	useEffect(() => {
		const delayedAction = async () => {
			await delay(2000);
			setSpeakers(data);
		};
		delayedAction();
	});
```

Now UI draws, then speakers appear ~2 seconds later.

But there's a problem. `useEffect()` is being called every time the `SpeakerList` renders. Click on a favorite icon. Watch it change, then change back 2 seconds later when `useEffect()` sets the state back to the original value again.

`useEffect()` takes an array (2nd parameter) that tells it what must change to qualify for running the effect. You can [skip effects](https://reactjs.org/docs/hooks-effect.html#tip-optimizing-performance-by-skipping-effects) that don't meet the conditions. Pass an empty array to never run after first run. (Now we don't lose favorite changes on the UI.)

### Loading indicator

What's a delay without a loading indicator? And what about errors (if the real world database dies)? So, we need to track:

-  Loading status
-  Error status (and message)

While loading, show a loading message.
If it errors, show an error message (`catch`).
Can `throw` an error on purpose to see the error behavior.

### Fallback renderer

A fallback renderer renders placeholder elements while your data is loading.

-  `npm install react-placeholder` and import it.
   -  https://www.npmjs.com/package/react-placeholder
-  Wrap the contents of the `container` `<div>` in `<ReactPlaceHolder>`
   -  Takes several attributes, but the important one is `ready` which defines the condition when the data is ready

But now I'm getting an error in the browser about an invalid hook call. Maybe because `react-placeholder` hasn't been updated for a year. Let's try `react-content-loader` which is more recent. I'm going to use one of the default loaders and worry about a custom loader later.

Okay, it's working in a way comparable to what he gets, so I'll fiddle with it later. Maybe switch to a simple spinner type loading indicator, given what I'm seeing.

**COMMIT: 3.0.1 - FEAT: use state to simulate async data loading**

## Good practices notes

-  Choose named functions vs. nameless lambdas wisely
   -  Named functions for callbacks are often clearer
-  `async/await` syntax is usually easier to reason about than chained Promises (`.then/.catch/.finally`)
